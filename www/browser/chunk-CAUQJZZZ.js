import{a as oe,b as ie,c as ne,e as ae,f as re,g as le,h as se,i as ce,j as me,k as de,l as pe,m as ue,n as $,o as fe,p as I,q as y,r as he,s as Se,u as _e}from"./chunk-SPESN3BV.js";import"./chunk-MYJO3HAP.js";import"./chunk-AOQDE75R.js";import{A as e,B as p,F as z,G as u,H as B,O as n,P as v,Pa as O,Q as R,Qa as D,S as K,Va as k,Wa as Q,Xa as A,Y as b,Ya as j,Za as q,_a as W,aa as g,ab as X,db as P,eb as V,gb as G,h as J,i as U,ka as d,kb as Y,la as E,lb as Z,ma as T,na as F,nb as ee,o as s,oa as x,ob as te,p as h,pa as M,r as C,sa as w,ta as N,v as _,y as c,z as o}from"./chunk-2G2L2QNG.js";import"./chunk-FXM2KW74.js";import"./chunk-NNH6CN3M.js";import"./chunk-HC6MZPB3.js";import"./chunk-4PGTP63H.js";import"./chunk-UKPPH64P.js";import"./chunk-FERD25SW.js";import"./chunk-SYQESB6R.js";import"./chunk-LEIMCQKJ.js";import"./chunk-N3PT3BRI.js";import"./chunk-MM5QLNJM.js";import"./chunk-72KDLSWN.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-5YEN3EPI.js";import"./chunk-MCRJI3T3.js";import"./chunk-PVZQOOQ7.js";import"./chunk-U2CNLB2V.js";import"./chunk-PVOLIMNR.js";import"./chunk-7QLMNM35.js";import"./chunk-FF3P7ZBM.js";import"./chunk-G3CV3VGG.js";import"./chunk-UDRXED5C.js";import"./chunk-FANUMIDU.js";import"./chunk-SB67TZC5.js";import"./chunk-4U6PRYVA.js";import"./chunk-QXT6YJJ4.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as H,f}from"./chunk-RW4GY4BD.js";function ve(l,a){if(l&1&&(o(0,"ion-select-option",12),n(1),e()),l&2){let m=a.$implicit;c("value",m),s(),v(m)}}var Ie=(()=>{let a=class a{constructor(t,i){this.modalController=t,this.fb=i,this.locationStatuses=Object.values(_e),this.locationForm=this.fb.group({location:["",d.required],description:["",d.required],type:["",d.required],status:["",d.required],start_date:[""],end_date:[""]})}ngOnInit(){}addLocation(){return f(this,null,function*(){if(this.locationForm.valid){let t=this.locationForm.value;t.start_date=new Date(t.start_date).toISOString().slice(0,10),t.end_date=new Date(t.end_date).toISOString().slice(0,10),this.modalController.dismiss(t)}})}closeModal(){this.modalController.dismiss()}};a.\u0275fac=function(i){return new(i||a)(h($),h(w))},a.\u0275cmp=C({type:a,selectors:[["app-add-location-modal"]],decls:36,vars:3,consts:[["slot","end"],[3,"click"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","location","placeholder","Enter location"],["formControlName","description","placeholder","Enter description"],["formControlName","type","placeholder","Enter type"],["formControlName","status","placeholder","Select status"],[3,"value",4,"ngFor","ngForOf"],["formControlName","start_date","type","date"],["formControlName","end_date","type","date"],["expand","full","type","submit",3,"disabled"],[3,"value"]],template:function(i,r){i&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n(3,"Add Location"),e(),o(4,"ion-buttons",0)(5,"ion-button",1),u("click",function(){return r.closeModal()}),n(6,"Close"),e()()()(),o(7,"ion-content")(8,"form",2),u("ngSubmit",function(){return r.addLocation()}),o(9,"ion-item")(10,"ion-label",3),n(11,"Location"),e(),p(12,"ion-input",4),e(),o(13,"ion-item")(14,"ion-label",3),n(15,"Description"),e(),p(16,"ion-input",5),e(),o(17,"ion-item")(18,"ion-label",3),n(19,"Type"),e(),p(20,"ion-input",6),e(),o(21,"ion-item")(22,"ion-label",3),n(23,"Status"),e(),o(24,"ion-select",7),_(25,ve,2,2,"ion-select-option",8),e()(),o(26,"ion-item")(27,"ion-label",3),n(28,"Start Date"),e(),p(29,"ion-input",9),e(),o(30,"ion-item")(31,"ion-label",3),n(32,"End Date"),e(),p(33,"ion-input",10),e(),o(34,"ion-button",11),n(35,"Add Location"),e()()()),i&2&&(s(8),c("formGroup",r.locationForm),s(17),c("ngForOf",r.locationStatuses),s(9),c("disabled",r.locationForm.invalid))},dependencies:[N,F,E,T,x,M,k,j,q,X,O,A,V,P,D,g,b,ee,te],encapsulation:2});let l=a;return l})();function Ee(l,a){if(l&1){let m=z();o(0,"ion-item")(1,"ion-label"),n(2),e(),o(3,"ion-checkbox",4),u("ionChange",function(){let i=J(m).$implicit,r=B();return U(r.toggleLocationSelection(i))}),e()()}if(l&2){let m=a.$implicit,t=B();s(2),v(m.location),s(),c("checked",t.isSelected(m))}}var ye=(()=>{let a=class a{constructor(t){this.modalController=t,this.locations=[],this.newLocations=[],this.selectedLocations=new Set}ngOnInit(){this.fetchLocations()}fetchLocations(){return f(this,null,function*(){let t=yield y(`${I}/locations/get`);t.ok?this.locations=yield t.json():console.error("Failed to fetch locations")})}isSelected(t){return this.selectedLocations.has(t)}toggleLocationSelection(t){this.selectedLocations.has(t)?this.selectedLocations.delete(t):this.selectedLocations.add(t)}openAddLocationModal(){return f(this,null,function*(){let t=yield this.modalController.create({component:Ie});t.onDidDismiss().then(i=>{i.data&&(this.locations.push(i.data),this.newLocations.push(i.data),this.selectedLocations.add(i.data))}),yield t.present()})}confirmSelection(){this.modalController.dismiss({selectedLocations:Array.from(this.selectedLocations),newLocations:this.newLocations})}selectLocation(t){this.modalController.dismiss(t)}closeModal(){this.modalController.dismiss()}};a.\u0275fac=function(i){return new(i||a)(h($))},a.\u0275cmp=C({type:a,selectors:[["app-select-location-modal"]],decls:18,vars:1,consts:[["slot","end"],[3,"click"],[4,"ngFor","ngForOf"],["slot","start"],["slot","start",3,"ionChange","checked"]],template:function(i,r){i&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n(3,"Select Locations"),e(),o(4,"ion-buttons",0)(5,"ion-button",1),u("click",function(){return r.closeModal()}),n(6,"Close"),e()()()(),o(7,"ion-content")(8,"ion-list"),_(9,Ee,4,2,"ion-item",2),e()(),o(10,"ion-footer")(11,"ion-toolbar")(12,"ion-buttons",3)(13,"ion-button",1),u("click",function(){return r.openAddLocationModal()}),n(14,"Add Location"),e()(),o(15,"ion-buttons",0)(16,"ion-button",1),u("click",function(){return r.confirmSelection()}),n(17,"Confirm"),e()()()()),i&2&&(s(9),c("ngForOf",r.locations))},dependencies:[A,V,P,D,O,k,W,j,q,Z,Q,g,b],encapsulation:2});let l=a;return l})();function Te(l,a){if(l&1&&(o(0,"ion-select-option",16),n(1),e()),l&2){let m=a.$implicit;c("value",m),s(),R(" ",m," ")}}function Fe(l,a){if(l&1&&(o(0,"ion-select-option",16),n(1),e()),l&2){let m=a.$implicit;c("value",m),s(),R(" ",m," ")}}var ze=(()=>{let a=class a{constructor(t,i,r){this.fb=t,this.toastController=i,this.modalController=r,this.tripTypes=Object.keys(he),this.tripStatuses=Object.keys(Se),this.selectedLocations=[],this.newLocations=[],this.tripForm=this.fb.group({description:["",d.required],type:["",d.required],status:["",d.required],destination:["",d.required],departure:["",d.required],start_date:["",d.required],end_date:["",d.required]})}ngOnInit(){}goToProfile(){return f(this,null,function*(){})}signOut(){return f(this,null,function*(){})}createTrip(){return f(this,null,function*(){if(this.tripForm.valid){let t=this.tripForm.value;t.start_date=new Date(t.start_date).toISOString().slice(0,10),t.end_date=new Date(t.end_date).toISOString().slice(0,10);let i=H({owner_id:parseInt(localStorage.getItem("user_id"))},t),r=yield y(`${I}/trips/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),S=parseInt(yield r.text());if(this.newLocations.length>0){for(let L=0;L<this.newLocations.length;L++)this.newLocations[L].trip_id=S;yield y(`${I}/locations/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newLocations)})}r.ok&&(this.tripForm.reset(),(yield this.toastController.create({message:"Trip created successfully",duration:2e3})).present())}})}openSelectLocationModal(){return f(this,null,function*(){let t=yield this.modalController.create({component:ye});yield t.present(),t.onDidDismiss().then(i=>{i.data&&(this.selectedLocations=i.data.selectedLocations,this.newLocations=i.data.newLocations)})})}};a.\u0275fac=function(i){return new(i||a)(h(w),h(Y),h(G))},a.\u0275cmp=C({type:a,selectors:[["app-tab2"]],features:[K([G])],decls:43,vars:6,consts:[["collapse","condense"],["size","large"],[3,"fullscreen"],[1,"form-container"],[1,"trip-form",3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","description","placeholder","Enter description"],["formControlName","type","placeholder","Select type"],[3,"value",4,"ngFor","ngForOf"],["formControlName","status","placeholder","Select status"],["formControlName","destination","placeholder","Enter destination"],["formControlName","departure","placeholder","Enter departure"],["formControlName","start_date","type","date"],["formControlName","end_date","type","date"],["readonly","",3,"click","value"],["expand","full","type","submit",1,"submit-button",3,"disabled"],[3,"value"]],template:function(i,r){i&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title",1),n(3,"Create Trip"),e()()(),o(4,"ion-content",2)(5,"div",3)(6,"form",4),u("ngSubmit",function(){return r.createTrip()}),o(7,"ion-item")(8,"ion-label",5),n(9,"Description"),e(),p(10,"ion-input",6),e(),o(11,"ion-item")(12,"ion-label",5),n(13,"Type"),e(),o(14,"ion-select",7),_(15,Te,2,2,"ion-select-option",8),e()(),o(16,"ion-item")(17,"ion-label",5),n(18,"Status"),e(),o(19,"ion-select",9),_(20,Fe,2,2,"ion-select-option",8),e()(),o(21,"ion-item")(22,"ion-label",5),n(23,"Destination"),e(),p(24,"ion-input",10),e(),o(25,"ion-item")(26,"ion-label",5),n(27,"Departure"),e(),p(28,"ion-input",11),e(),o(29,"ion-item")(30,"ion-label",5),n(31,"Start Date"),e(),p(32,"ion-input",12),e(),o(33,"ion-item")(34,"ion-label",5),n(35,"End Date"),e(),p(36,"ion-input",13),e(),o(37,"ion-item")(38,"ion-label",5),n(39,"Locations"),e(),o(40,"ion-input",14),u("click",function(){return r.openSelectLocationModal()}),e()(),o(41,"ion-button",15),n(42,"Create Trip"),e()()()()),i&2&&(s(4),c("fullscreen",!0),s(2),c("formGroup",r.tripForm),s(9),c("ngForOf",r.tripTypes),s(5),c("ngForOf",r.tripStatuses),s(20),c("value",r.selectedLocations.length+" locations selected"),s(),c("disabled",r.tripForm.invalid))},dependencies:[fe,ne,ae,re,le,se,ce,me,de,pe,ue,oe,ie,g,b,N,F,E,T,x,M],encapsulation:2});let l=a;return l})();export{ze as Tab2Page};
