import{a as _e,c as he,f as Ie,g as Ce}from"./chunk-IJ3D76ZM.js";import{n as Z,p as h,q as I,r as Se,s as ge,t as Te}from"./chunk-SPESN3BV.js";import"./chunk-MYJO3HAP.js";import"./chunk-AOQDE75R.js";import{$ as j,$a as re,A as e,B as g,F as G,G as d,H as F,O as o,P as _,Pa as y,Q as q,Qa as k,R as M,S as R,T as U,U as A,Va as x,Wa as Y,Xa as O,Y as b,Ya as E,Z as ne,Za as w,_a as P,aa as v,ab as ae,db as N,ea as oe,eb as $,gb as L,h as V,hb as le,i as B,jb as se,ka as D,kb as me,la as H,lb as pe,ma as J,mb as de,na as W,nb as ce,o as s,oa as z,ob as ue,p as u,pa as K,pb as fe,r as T,sa as Q,ta as X,v as S,y as f,z as t}from"./chunk-2G2L2QNG.js";import"./chunk-FXM2KW74.js";import"./chunk-NNH6CN3M.js";import"./chunk-HC6MZPB3.js";import"./chunk-4PGTP63H.js";import"./chunk-UKPPH64P.js";import"./chunk-FERD25SW.js";import"./chunk-SYQESB6R.js";import"./chunk-LEIMCQKJ.js";import"./chunk-N3PT3BRI.js";import"./chunk-MM5QLNJM.js";import"./chunk-72KDLSWN.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-5YEN3EPI.js";import"./chunk-MCRJI3T3.js";import"./chunk-PVZQOOQ7.js";import"./chunk-U2CNLB2V.js";import"./chunk-PVOLIMNR.js";import"./chunk-7QLMNM35.js";import"./chunk-FF3P7ZBM.js";import"./chunk-G3CV3VGG.js";import"./chunk-UDRXED5C.js";import"./chunk-FANUMIDU.js";import"./chunk-SB67TZC5.js";import"./chunk-4U6PRYVA.js";import"./chunk-QXT6YJJ4.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as c}from"./chunk-RW4GY4BD.js";function we(l,a){if(l&1&&(t(0,"ion-select-option",13),o(1),e()),l&2){let m=a.$implicit;f("value",m),s(),_(m)}}function Me(l,a){if(l&1&&(t(0,"ion-select-option",13),o(1),e()),l&2){let m=a.$implicit;f("value",m),s(),_(m)}}var be=(()=>{let a=class a{constructor(i,n){this.fb=i,this.modalController=n,this.tripTypes=Object.keys(Se),this.tripStatuses=Object.keys(ge),this.editTripForm=this.fb.group({description:["",D.required],type:["",D.required],status:["",D.required],destination:["",D.required],departure:["",D.required],start_date:["",D.required],end_date:["",D.required]})}ngOnInit(){this.trip&&this.editTripForm.patchValue(this.trip)}saveTrip(){return c(this,null,function*(){if(this.editTripForm.valid){let i=this.editTripForm.value;i.start_date=new Date(i.start_date).toISOString().slice(0,10),i.end_date=new Date(i.end_date).toISOString().slice(0,10),i.owner_id=this.trip.owner_id;try{(yield I(`${h}/trips/${this.trip.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok?this.modalController.dismiss(i):console.error("Failed to update trip")}catch(n){console.error("API error:",n)}}})}closeModal(){this.modalController.dismiss()}};a.\u0275fac=function(n){return new(n||a)(u(Q),u(L))},a.\u0275cmp=T({type:a,selectors:[["app-edit-trip-modal"]],inputs:{trip:"trip"},decls:41,vars:4,consts:[["slot","end"],[3,"click"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","description"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["formControlName","status"],["formControlName","destination"],["formControlName","departure"],["formControlName","start_date","type","date"],["formControlName","end_date","type","date"],["expand","full","type","submit",3,"disabled"],[3,"value"]],template:function(n,r){n&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o(3,"Edit Trip"),e(),t(4,"ion-buttons",0)(5,"ion-button",1),d("click",function(){return r.closeModal()}),o(6,"Close"),e()()()(),t(7,"ion-content")(8,"form",2),d("ngSubmit",function(){return r.saveTrip()}),t(9,"ion-item")(10,"ion-label",3),o(11,"Description"),e(),g(12,"ion-input",4),e(),t(13,"ion-item")(14,"ion-label",3),o(15,"Type"),e(),t(16,"ion-select",5),S(17,we,2,2,"ion-select-option",6),e()(),t(18,"ion-item")(19,"ion-label",3),o(20,"Status"),e(),t(21,"ion-select",7),S(22,Me,2,2,"ion-select-option",6),e()(),t(23,"ion-item")(24,"ion-label",3),o(25,"Destination"),e(),g(26,"ion-input",8),e(),t(27,"ion-item")(28,"ion-label",3),o(29,"Departure"),e(),g(30,"ion-input",9),e(),t(31,"ion-item")(32,"ion-label",3),o(33,"Start Date"),e(),g(34,"ion-input",10),e(),t(35,"ion-item")(36,"ion-label",3),o(37,"End Date"),e(),g(38,"ion-input",11),e(),t(39,"ion-button",12),o(40,"Save"),e()()()),n&2&&(s(8),f("formGroup",r.editTripForm),s(9),f("ngForOf",r.tripTypes),s(5),f("ngForOf",r.tripStatuses),s(17),f("disabled",r.editTripForm.invalid))},dependencies:[v,b,k,O,$,N,x,y,ce,E,w,X,W,H,J,z,K,ue,ae],encapsulation:2});let l=a;return l})();function Fe(l,a){if(l&1){let m=G();t(0,"ion-item")(1,"ion-label"),o(2),e(),t(3,"ion-checkbox",3),d("ionChange",function(){let n=V(m).$implicit,r=F();return B(r.toggleUserSelection(n.id))}),e()()}if(l&2){let m=a.$implicit;s(2),M("",m.name," (",m.email,")")}}var ve=(()=>{let a=class a{constructor(i,n){this.modalController=i,this.toastController=n,this.users=[],this.selectedUserIds=new Set}ngOnInit(){this.fetchUsers()}fetchUsers(){return c(this,null,function*(){try{let i=yield I(`${h}/trips/${this.tripId}/${this.ownerId}/valid_users`);i.ok?this.users=yield i.json():console.error("Failed to fetch users")}catch(i){console.error("API error:",i)}})}toggleUserSelection(i){this.selectedUserIds.has(i)?this.selectedUserIds.delete(i):this.selectedUserIds.add(i)}shareTrip(){return c(this,null,function*(){try{if((yield I(`${h}/trips/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trip_id:this.tripId,user_ids:Array.from(this.selectedUserIds)})})).ok){let r=this.users.filter(C=>this.selectedUserIds.has(C.id)).map(C=>C.name).join(", ");(yield this.toastController.create({message:`Trip shared successfully with ${r}!`,duration:5e3})).present(),this.modalController.dismiss()}else console.error("Failed to share trip")}catch(i){console.error("API error:",i)}})}closeModal(){this.modalController.dismiss()}};a.\u0275fac=function(n){return new(n||a)(u(L),u(me))},a.\u0275cmp=T({type:a,selectors:[["app-share-trip-modal"]],inputs:{tripId:"tripId"},decls:15,vars:1,consts:[["slot","end"],[3,"click"],[4,"ngFor","ngForOf"],["slot","start",3,"ionChange"]],template:function(n,r){n&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o(3,"Share Trip"),e(),t(4,"ion-buttons",0)(5,"ion-button",1),d("click",function(){return r.closeModal()}),o(6,"Close"),e()()()(),t(7,"ion-content")(8,"ion-list"),S(9,Fe,4,2,"ion-item",2),e()(),t(10,"ion-footer")(11,"ion-toolbar")(12,"ion-buttons",0)(13,"ion-button",1),d("click",function(){return r.shareTrip()}),o(14,"Share"),e()()()()),n&2&&(s(9),f("ngForOf",r.users))},dependencies:[Y,O,$,N,x,y,E,w,pe,P,k,v,b],encapsulation:2});let l=a;return l})();function De(l,a){if(l&1&&(t(0,"ion-item")(1,"ion-label")(2,"h2"),o(3),e(),t(4,"p"),o(5),e(),t(6,"p"),o(7),e(),t(8,"p"),o(9),e(),t(10,"p"),o(11),U(12,"date"),U(13,"date"),e()()()),l&2){let m=a.$implicit;s(3),_(m.location),s(2),q("Description: ",m.description,""),s(2),q("Type: ",m.type,""),s(2),q("Status: ",m.status,""),s(2),M(" Date: ",A(12,6,m.start_date,"longDate")," - ",A(13,9,m.end_date,"longDate")," ")}}var ye=(()=>{let a=class a{constructor(i){this.modalController=i,this.locations=[]}closeModal(){this.modalController.dismiss()}};a.\u0275fac=function(n){return new(n||a)(u(Z))},a.\u0275cmp=T({type:a,selectors:[["app-locations-modal"]],features:[R([Z])],decls:10,vars:1,consts:[["slot","end"],[3,"click"],[4,"ngFor","ngForOf"]],template:function(n,r){n&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o(3,"Locations"),e(),t(4,"ion-buttons",0)(5,"ion-button",1),d("click",function(){return r.closeModal()}),o(6,"Close"),e()()()(),t(7,"ion-content")(8,"ion-list"),S(9,De,14,12,"ion-item",2),e()()),n&2&&(s(9),f("ngForOf",r.locations))},dependencies:[O,$,N,k,y,x,P,E,w,j,v,b],encapsulation:2});let l=a;return l})();function ke(l,a){if(l&1&&(t(0,"ion-item")(1,"ion-label"),o(2,"Owner"),e(),t(3,"div"),o(4),e()()),l&2){let m=F();s(4),M("",m.owner.name," (",m.owner.email,")")}}function Oe(l,a){if(l&1&&(t(0,"ion-item")(1,"ion-label"),o(2),e()()),l&2){let m=a.$implicit;s(2),M("",m.user_name,": ",m.comment,"")}}var xe=(()=>{let a=class a{constructor(i,n,r){this.modalController=i,this.datePipe=n,this.fb=r,this.owner=null,this.comments=[],this.locations=[],this.commentForm=this.fb.group({comment:[""]})}ngOnInit(){this.trip.shared&&this.getOwner(),this.fetchComments(),this.fetchLocations()}fetchLocations(){return c(this,null,function*(){let i=yield I(`${h}/trips/${this.trip.id}/locations`);this.locations=yield i.json()})}fetchComments(){return c(this,null,function*(){let i=yield I(`${h}/trips/${this.trip.id}/comments`);this.comments=yield i.json()})}addComment(){return c(this,null,function*(){var r;let i=(r=this.commentForm.get("comment"))==null?void 0:r.value.trim();if(!i)return;let n=yield I(`${h}/trips/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trip_id:this.trip.id,user_id:parseInt(localStorage.getItem("user_id")),comment:i})});if(n.ok){let p=yield n.text(),C={id:parseInt(p),trip_id:this.trip.id,user_id:parseInt(localStorage.getItem("user_id")),user_name:localStorage.getItem("name"),comment:i};this.comments.push(C),this.commentForm.reset()}})}shareTrip(){return c(this,null,function*(){yield(yield this.modalController.create({component:ve,componentProps:{tripId:this.trip.id,ownerId:this.trip.owner_id}})).present()})}getOwner(){return c(this,null,function*(){let i=this.trip.owner_id,r=yield(yield I(`${h}/users/${i}`)).json();this.owner=r})}openLocationsModal(){return c(this,null,function*(){yield(yield this.modalController.create({component:ye,componentProps:{locations:this.locations}})).present()})}closeModal(){this.modalController.dismiss()}};a.\u0275fac=function(n){return new(n||a)(u(L),u(j),u(Q))},a.\u0275cmp=T({type:a,selectors:[["app-trip-details-modal"]],inputs:{trip:"trip"},features:[R([j])],decls:70,vars:16,consts:[["slot","end"],[3,"click"],[4,"ngIf"],["button","",3,"click"],[1,"comments-section"],[4,"ngFor","ngForOf"],[1,"comment-form",3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","comment","placeholder","Enter your comment here"],["expand","full","type","submit"],["slot","start"]],template:function(n,r){n&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o(3,"Trip Details"),e(),t(4,"ion-buttons",0)(5,"ion-button",1),d("click",function(){return r.closeModal()}),o(6,"Close"),e()()()(),t(7,"ion-content")(8,"ion-item")(9,"ion-label"),o(10,"Description"),e(),t(11,"div"),o(12),e()(),t(13,"ion-item")(14,"ion-label"),o(15,"Type"),e(),t(16,"div"),o(17),e()(),t(18,"ion-item")(19,"ion-label"),o(20,"Status"),e(),t(21,"div"),o(22),e()(),t(23,"ion-item")(24,"ion-label"),o(25,"Destination"),e(),t(26,"div"),o(27),e()(),t(28,"ion-item")(29,"ion-label"),o(30,"Departure"),e(),t(31,"div"),o(32),e()(),t(33,"ion-item")(34,"ion-label"),o(35,"Start Date"),e(),t(36,"div"),o(37),U(38,"date"),e()(),t(39,"ion-item")(40,"ion-label"),o(41,"End Date"),e(),t(42,"div"),o(43),U(44,"date"),e()(),S(45,ke,5,2,"ion-item",2),t(46,"ion-item",3),d("click",function(){return r.openLocationsModal()}),t(47,"ion-label"),o(48,"View Locations"),e()(),t(49,"div",4)(50,"ion-list")(51,"ion-list-header")(52,"ion-label"),o(53,"Comments"),e()(),S(54,Oe,3,2,"ion-item",5),e()(),t(55,"form",6),d("ngSubmit",function(){return r.addComment()}),t(56,"ion-item")(57,"ion-label",7),o(58,"Write a Comment"),e(),g(59,"ion-textarea",8),e(),t(60,"ion-button",9),o(61,"Add Comment"),e()()(),t(62,"ion-footer")(63,"ion-toolbar")(64,"ion-buttons",10)(65,"ion-button",1),d("click",function(){return r.addComment()}),o(66,"Add Comment"),e()(),t(67,"ion-buttons",0)(68,"ion-button",1),d("click",function(){return r.shareTrip()}),o(69,"Share Trip"),e()()()()),n&2&&(s(12),_(r.trip.description),s(5),_(r.trip.type),s(5),_(r.trip.status),s(5),_(r.trip.destination),s(5),_(r.trip.departure),s(5),_(A(38,10,r.trip.start_date,"longDate")),s(6),_(A(44,13,r.trip.end_date,"longDate")),s(2),f("ngIf",r.owner),s(9),f("ngForOf",r.comments),s(),f("formGroup",r.commentForm))},dependencies:[O,$,N,x,y,E,w,k,j,v,b,ne,Y,fe,P,re,X,W,H,J,z,K],styles:["ion-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.trip-details[_ngcontent-%COMP%], .comments-section[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.comment-form[_ngcontent-%COMP%]{margin-top:auto}"]});let l=a;return l})();function Pe(l,a){if(l&1){let m=G();t(0,"ion-item",1),d("click",function(){let n=V(m).$implicit,r=F();return B(r.showTripDetails(n))}),t(1,"ion-label")(2,"h2"),o(3),e(),t(4,"p"),o(5),e()(),t(6,"ion-button",2),d("click",function(n){let r=V(m).$implicit,p=F();return B(p.editTrip(n,r))}),g(7,"ion-icon",3),e(),t(8,"ion-button",4),d("click",function(n){let r=V(m).$implicit,p=F();return B(p.removeTrip(n,r))}),g(9,"ion-icon",5),e()()}if(l&2){let m=a.$implicit;s(3),_(m.description),s(2),M("",m.destination," - ",m.departure,"")}}var ct=(()=>{let a=class a{constructor(i,n,r,p){this.alertController=i,this.modalController=n,this.popoverController=r,this.router=p,this.trips=[],_e({"create-outline":he,"trash-outline":Ce,"settings-outline":Ie})}ionViewWillEnter(){Te().then(i=>{this.trips=i})}showTripDetails(i){return c(this,null,function*(){yield(yield this.modalController.create({component:xe,componentProps:{trip:i}})).present()})}editTrip(i,n){return c(this,null,function*(){i.stopPropagation();let r=yield this.modalController.create({component:be,componentProps:{trip:n}});r.onDidDismiss().then(p=>c(this,null,function*(){if(p.data)for(let C=0;C<this.trips.length;C++)this.trips[C].id===p.data.id&&(this.trips[C]=p.data)})),yield r.present()})}removeTrip(i,n){return c(this,null,function*(){i.stopPropagation(),yield(yield this.alertController.create({header:"Confirm!",message:"Are you sure you want to delete this trip?",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Delete",handler:()=>c(this,null,function*(){n.shared?yield I(`${h}/trips/delete_shared`,{method:"DELETE",body:JSON.stringify({trip_id:n.id,user_id:parseInt(localStorage.getItem("user_id"))})}):yield I(`${h}/trips/${n.id}`,{method:"DELETE"});let p=n.id;this.trips=this.trips.filter(C=>C.id!==p)})}]})).present()})}};a.\u0275fac=function(n){return new(n||a)(u(se),u(L),u(le),u(oe))},a.\u0275cmp=T({type:a,selectors:[["app-tab1"]],decls:3,vars:1,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"],["fill","clear",3,"click"],["slot","icon-only","name","create-outline"],["fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(n,r){n&1&&(t(0,"ion-content")(1,"ion-list"),S(2,Pe,10,3,"ion-item",0),e()()),n&2&&(s(2),f("ngForOf",r.trips))},dependencies:[v,b,x,P,E,w,y,de],encapsulation:2});let l=a;return l})();export{ct as Tab1Page};
