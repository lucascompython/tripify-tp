import{a as et,c as ot,g as it}from"./chunk-IJ3D76ZM.js";import{a as nt,b as at,c as lt,d as rt,e as mt,f as st,g as ct,h as dt,i as pt,j as ut,k as ft,l as _t,m as ht,n as v,o as St,p as S,q as I}from"./chunk-SPESN3BV.js";import"./chunk-MYJO3HAP.js";import"./chunk-AOQDE75R.js";import{$ as K,$a as W,A as t,B as d,F as U,G as _,H as L,O as n,P as p,Pa as P,Qa as Q,R as q,S as z,T as H,U as J,Va as V,Xa as $,Y as b,Ya as j,Za as B,_a as G,aa as E,db as A,eb as R,gb as X,h as y,i as F,ka as x,kb as Y,la as T,ma as M,mb as Z,na as D,o as m,oa as w,p as h,pa as k,pb as tt,r as g,sa as N,ta as O,v as C,y as f,z as e}from"./chunk-2G2L2QNG.js";import"./chunk-FXM2KW74.js";import"./chunk-NNH6CN3M.js";import"./chunk-HC6MZPB3.js";import"./chunk-4PGTP63H.js";import"./chunk-UKPPH64P.js";import"./chunk-FERD25SW.js";import"./chunk-SYQESB6R.js";import"./chunk-LEIMCQKJ.js";import"./chunk-N3PT3BRI.js";import"./chunk-MM5QLNJM.js";import"./chunk-72KDLSWN.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-5YEN3EPI.js";import"./chunk-MCRJI3T3.js";import"./chunk-PVZQOOQ7.js";import"./chunk-U2CNLB2V.js";import"./chunk-PVOLIMNR.js";import"./chunk-7QLMNM35.js";import"./chunk-FF3P7ZBM.js";import"./chunk-G3CV3VGG.js";import"./chunk-UDRXED5C.js";import"./chunk-FANUMIDU.js";import"./chunk-SB67TZC5.js";import"./chunk-4U6PRYVA.js";import"./chunk-QXT6YJJ4.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as u}from"./chunk-RW4GY4BD.js";function yt(r,l){if(r&1&&(e(0,"ion-select-option",12),n(1),t()),r&2){let c=l.$implicit;f("value",c),m(),p(c)}}var Ct=(()=>{let l=class l{constructor(o,a,i){this.modalController=o,this.fb=a,this.toastController=i,this.locationStatuses=["Planned","Visited","Skipped"],this.locationForm=this.fb.group({location:["",x.required],description:["",x.required],type:["",x.required],status:["",x.required],start_date:[""],end_date:[""]})}ngOnInit(){this.location&&this.locationForm.patchValue(this.location)}editLocation(){return u(this,null,function*(){if(this.locationForm.valid){let o=this.locationForm.value;o.start_date=new Date(o.end_date).toISOString().slice(0,10),o.end_date=new Date(o.end_date).toISOString().slice(0,10),o.trip_id=this.location.trip_id,console.log(JSON.stringify(o)),(yield I(`${S}/locations/${this.location.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok?(o.id=this.location.id,this.modalController.dismiss(o),yield(yield this.toastController.create({message:"Location updated",duration:2e3})).present()):console.error("Failed to update location")}})}closeModal(){this.modalController.dismiss()}};l.\u0275fac=function(a){return new(a||l)(h(v),h(N),h(Y))},l.\u0275cmp=g({type:l,selectors:[["app-edit-location-modal"]],inputs:{location:"location"},decls:36,vars:2,consts:[["slot","end"],[3,"click"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","location","placeholder","Enter location"],["formControlName","description","placeholder","Enter description"],["formControlName","type","placeholder","Enter type"],["formControlName","status","placeholder","Select status"],[3,"value",4,"ngFor","ngForOf"],["formControlName","start_date","type","date"],["formControlName","end_date","type","date"],["expand","full","type","submit"],[3,"value"]],template:function(a,i){a&1&&(e(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n(3,"Edit Location"),t(),e(4,"ion-buttons",0)(5,"ion-button",1),_("click",function(){return i.closeModal()}),n(6,"Close"),t()()()(),e(7,"ion-content")(8,"form",2),_("ngSubmit",function(){return i.editLocation()}),e(9,"ion-item")(10,"ion-label",3),n(11,"Location"),t(),d(12,"ion-input",4),t(),e(13,"ion-item")(14,"ion-label",3),n(15,"Description"),t(),d(16,"ion-input",5),t(),e(17,"ion-item")(18,"ion-label",3),n(19,"Type"),t(),d(20,"ion-input",6),t(),e(21,"ion-item")(22,"ion-label",3),n(23,"Status"),t(),e(24,"ion-select",7),C(25,yt,2,2,"ion-select-option",8),t()(),e(26,"ion-item")(27,"ion-label",3),n(28,"Start Date"),t(),d(29,"ion-input",9),t(),e(30,"ion-item")(31,"ion-label",3),n(32,"End Date"),t(),d(33,"ion-input",10),t(),e(34,"ion-button",11),n(35,"Save"),t()()()),a&2&&(m(8),f("formGroup",i.locationForm),m(17),f("ngForOf",i.locationStatuses))},dependencies:[E,b,St,lt,rt,mt,st,ct,dt,pt,ut,ft,_t,ht,nt,at,O,D,T,M,w,k],encapsulation:2});let r=l;return r})();function Ft(r,l){if(r&1&&(e(0,"ion-item")(1,"ion-label"),n(2),t()()),r&2){let c=l.$implicit;m(2),q("",c.user_name,": ",c.comment,"")}}var bt=(()=>{let l=class l{constructor(o,a){this.modalController=o,this.fb=a,this.comments=[],this.commentForm=this.fb.group({comment:[""]})}ngOnInit(){this.fetchComments()}fetchComments(){return u(this,null,function*(){let o=yield I(`${S}/locations/${this.location.id}/comments`);o.ok?this.comments=yield o.json():console.error("Failed to fetch comments")})}addComment(){return u(this,null,function*(){let o={location_id:this.location.id,user_id:parseInt(localStorage.getItem("user_id")),comment:this.commentForm.value.comment};console.log(JSON.stringify(o));let a=yield I(`${S}/locations/comment`,{method:"POST",body:JSON.stringify(o)});if(a.ok){this.fetchComments();let i=yield a.text(),s={id:parseInt(i),location_id:this.location.id,user_id:parseInt(localStorage.getItem("user_id")),user_name:localStorage.getItem("user_name"),comment:this.commentForm.value.comment};this.comments.push(s),this.commentForm.reset()}else console.error("Failed to add comment")})}closeModal(){this.modalController.dismiss()}};l.\u0275fac=function(a){return new(a||l)(h(v),h(N))},l.\u0275cmp=g({type:l,selectors:[["app-location-details-modal"]],inputs:{location:"location"},features:[z([v])],decls:52,vars:16,consts:[["slot","end"],[3,"click"],[4,"ngFor","ngForOf"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","comment","placeholder","Enter your comment"],["expand","full","type","submit",3,"disabled"]],template:function(a,i){a&1&&(e(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n(3,"Location Details"),t(),e(4,"ion-buttons",0)(5,"ion-button",1),_("click",function(){return i.closeModal()}),n(6,"Close"),t()()()(),e(7,"ion-content")(8,"ion-item")(9,"ion-label"),n(10,"Name"),t(),e(11,"div"),n(12),t()(),e(13,"ion-item")(14,"ion-label"),n(15,"Description"),t(),e(16,"div"),n(17),t()(),e(18,"ion-item")(19,"ion-label"),n(20,"Type"),t(),e(21,"div"),n(22),t()(),e(23,"ion-item")(24,"ion-label"),n(25,"Status"),t(),e(26,"div"),n(27),t()(),e(28,"ion-item")(29,"ion-label"),n(30,"Trip"),t(),e(31,"div"),n(32),t()(),e(33,"ion-item")(34,"ion-label"),n(35,"Date"),t(),e(36,"div"),n(37),H(38,"date"),H(39,"date"),t()(),e(40,"ion-list")(41,"ion-list-header")(42,"ion-label"),n(43,"Comments"),t()(),C(44,Ft,3,2,"ion-item",2),t(),e(45,"form",3),_("ngSubmit",function(){return i.addComment()}),e(46,"ion-item")(47,"ion-label",4),n(48,"Add Comment"),t(),d(49,"ion-textarea",5),t(),e(50,"ion-button",6),n(51,"Submit"),t()()()),a&2&&(m(12),p(i.location.location),m(5),p(i.location.description),m(5),p(i.location.type),m(5),p(i.location.status),m(5),p(i.location.trip_description),m(5),q(" ",J(38,10,i.location.start_date,"longDate")," - ",J(39,13,i.location.end_date,"longDate")," "),m(7),f("ngForOf",i.comments),m(),f("formGroup",i.commentForm),m(5),f("disabled",i.commentForm.invalid))},dependencies:[$,R,A,Q,P,V,j,B,K,G,W,E,b,O,D,T,M,w,k,tt],encapsulation:2});let r=l;return r})();function Lt(r,l){if(r&1){let c=U();e(0,"ion-item",1),_("click",function(){let a=y(c).$implicit,i=L();return F(i.openLocationDetailsModal(a))}),e(1,"ion-label")(2,"h2"),n(3),t(),e(4,"p"),n(5),t()(),e(6,"ion-button",2),_("click",function(a){let i=y(c).$implicit;return L().openEditLocationModal(i),F(a.stopPropagation())}),d(7,"ion-icon",3),t(),e(8,"ion-button",4),_("click",function(a){let i=y(c).$implicit;return L().deleteLocation(i.id),F(a.stopPropagation())}),d(9,"ion-icon",5),t()()}if(r&2){let c=l.$implicit;m(3),p(c.location),m(2),p(c.description)}}var Kt=(()=>{let l=class l{constructor(o){this.modalController=o,this.locations=[],et({"create-outline":ot,"trash-outline":it})}ngOnInit(){this.fetchLocations()}fetchLocations(){return u(this,null,function*(){let o=yield I(`${S}/locations/get`);o.ok?this.locations=yield o.json():console.error("Failed to fetch locations")})}openEditLocationModal(o){return u(this,null,function*(){let a=yield this.modalController.create({component:Ct,componentProps:{location:o}});a.onDidDismiss().then(i=>{if(i.data){console.log(i.data);for(let s=0;s<this.locations.length;s++)if(console.log("location id: ",this.locations[s].id),this.locations[s].id===i.data.id){this.locations[s]=i.data;break}}}),yield a.present()})}openLocationDetailsModal(o){return u(this,null,function*(){yield(yield this.modalController.create({component:bt,componentProps:{location:o}})).present()})}deleteLocation(o){return u(this,null,function*(){(yield I(`${S}/locations/${o}`,{method:"DELETE"})).ok?this.locations=this.locations.filter(i=>i.id!==o):console.error("Failed to delete location")})}};l.\u0275fac=function(a){return new(a||l)(h(X))},l.\u0275cmp=g({type:l,selectors:[["app-tab3"]],decls:7,vars:1,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","create-outline"],["slot","end","color","danger","fill","clear",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(a,i){a&1&&(e(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n(3,"Locations"),t()()(),e(4,"ion-content")(5,"ion-list"),C(6,Lt,10,2,"ion-item",0),t()()),a&2&&(m(6),f("ngForOf",i.locations))},dependencies:[$,R,A,V,G,j,B,P,E,b,Z],encapsulation:2});let r=l;return r})();export{Kt as Tab3Page};
